<!DOCTYPE html><html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Star Bird: Crypto Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --main-yellow: #fcd34d; --bg-sky: #0ea5e9; --danger: #ef4444; --accent-blue: #3b82f6; --boost: #a855f7; }
        body { font-family: 'Segoe UI', sans-serif; background: #020617; color: white; text-align: center; margin: 0; padding: 10px; overflow-x: hidden; touch-action: manipulation; transition: background 0.2s; }
        
        .turbo-mode { animation: flashBg 0.2s infinite; }
        @keyframes flashBg { 0% { background: #020617; } 50% { background: #1e293b; } 100% { background: #020617; } }

        .withdraw-panel { background: var(--accent-blue); border-radius: 15px; padding: 12px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .progress-container { background: rgba(0,0,0,0.3); height: 8px; border-radius: 10px; margin-top: 8px; overflow: hidden; }
        #progressBar { background: var(--main-yellow); width: 0%; height: 100%; transition: 0.5s; }
        
        .wallet-card { background: #1e293b; border-radius: 20px; padding: 15px; margin-bottom: 10px; border: 1px solid #334155; display: flex; justify-content: space-around; cursor: pointer; }
        .balance-value { font-size: 22px; color: var(--main-yellow); font-weight: bold; }

        #game-scene { 
            position: relative; width: 100%; height: 240px; 
            background: linear-gradient(180deg, #38bdf8 0%, #0ea5e9 100%); 
            border-radius: 24px; overflow: hidden; margin-bottom: 10px; border: 3px solid #1e293b;
        }

        .cloud { position: absolute; color: white; opacity: 0.3; font-size: 30px; animation: moveCloud linear infinite; z-index: 5; }
        @keyframes moveCloud { from { right: -50px; } to { right: 110%; } }

        #bird-container { position: absolute; left: 40px; top: 50%; transform: translateY(-50%); z-index: 15; transition: top 0.2s; }
        #bird { font-size: 50px; transform: scaleX(-1); display: inline-block; }
        #multiplier-badge { 
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 10px;
            font-size: 14px; font-weight: bold; color: var(--main-yellow);
            white-space: nowrap; display: none;
        }

        .star-prize { 
            position: absolute; right: -50px; font-size: 26px; z-index: 12; 
            transition: right 0.5s linear; pointer-events: none;
            filter: drop-shadow(0 0 10px gold);
        }
        
        .crash-symbol { font-size: 38px; filter: drop-shadow(0 0 15px red); }
        .crash-instant { position: absolute; right: 85px !important; transition: none !important; animation: shake 0.2s infinite; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -3px); } 100% { transform: translate(2px, 2px); } }

        .extra-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        .mini-card { background: #1e293b; padding: 8px 2px; border-radius: 10px; font-size: 9px; color: #94a3b8; border: 1px solid #334155; font-weight: bold; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { padding: 12px 5px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: white; font-size: 11px; transition: 0.2s; box-shadow: 0 3px 0 rgba(0,0,0,0.3); }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        .btn:disabled { background: #475569 !important; color: #94a3b8; cursor: not-allowed; box-shadow: none; transform: none; }
        
        .btn-free { background: #8b5cf6; grid-column: span 2; border: 2px solid #a78bfa; }
        .btn-std { background: #10b981; }
        .btn-super { background: #f59e0b; }
        .btn-boost { background: var(--boost); grid-column: span 2; }
        .btn-energy { background: #ec4899; grid-column: span 2; font-size: 13px; }
        .btn-ref { background: #3b82f6; grid-column: span 2; }
        
        .btn-take { background: var(--main-yellow); color: #000; grid-column: span 2; display: none; font-size: 20px; animation: pulse 1s infinite; border: 3px solid #b45309; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
        
        .history-panel { background: #1e293b; border-radius: 15px; padding: 10px; margin-top: 15px; border: 1px solid #334155; }
        .history-title { font-size: 10px; color: #94a3b8; text-transform: uppercase; margin-bottom: 8px; }
        .history-list { display: flex; flex-direction: column-reverse; gap: 5px; max-height: 100px; overflow-y: auto; }
        .history-item { display: flex; justify-content: space-between; font-size: 11px; padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px; }
        .hist-win { color: #10b981; }
        .hist-loss { color: #ef4444; }
    </style></head><body>

    <div class="withdraw-panel">
        <div class="stats-grid" style="display: flex; justify-content: space-around; font-size: 10px;">
            <span>–ü–†–û–ì–†–ï–°–°: <span id="with-val">0</span>%</span>
            <span>–î–†–£–ó–¨–Ø: <span id="ref-val">0</span>/5</span>
        </div>
        <div class="progress-container"><div id="progressBar"></div></div>
    </div>

    <div class="extra-grid">
        <div class="mini-card">–ú–ê–ì–ê–ó–ò–ù<br>–°–ö–û–†–û...</div>
        <div class="mini-card">–õ–ò–ì–ê<br>–°–ö–û–†–û...</div>
        <div class="mini-card">–ö–ï–ô–°–´<br>–°–ö–û–†–û...</div>
    </div>

    <div class="wallet-card" onclick="buyStars()">
        <div style="text-align:left"><small>–ë–ê–õ–ê–ù–°</small><div class="balance-value"><span id="balanceDisplay">0</span> ‚≠ê</div></div>
        <div style="text-align:right"><small>–í –ü–û–õ–ï–¢–ï</small><div class="balance-value" style="color:white"><span id="currentWin">0</span> ‚≠ê</div></div>
    </div>

    <div id="game-scene">
        <div id="bird-container">
            <div id="multiplier-badge">x1.00</div>
            <div id="bird">üê¶‚Äç‚¨õ</div>
        </div>
    </div>

    <div class="controls" id="mainControls">
        <button id="freeBtn" class="btn btn-free">–ë–ï–°–ü–õ–ê–¢–ù–´–ô –ü–û–õ–ï–¢ (TEST)</button>
        <button id="energyBtn" class="btn btn-energy">‚ö° –ö–£–ü–ò–¢–¨ –≠–ù–ï–†–ì–ò–Æ (25 ‚≠ê)</button>
        <button id="stdBtn" class="btn btn-std">–û–ë–´–ß–ù–´–ô (50)</button>
        <button id="superBtn" class="btn btn-super">–°–£–ü–ï–† (150)</button>
        <button id="boostBtn" class="btn btn-boost">üî• –ë–£–°–¢–ï–† (300) üî•</button>
        <button id="refBtn" class="btn btn-ref">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ó–ï–ô</button>
    </div>
    
    <button id="takeBtn" class="btn btn-take">–ó–ê–ë–†–ê–¢–¨: 0 ‚≠ê</button>
    <button id="withdrawBtn" style="background:#1e293b; color:#64748b; width:100%; border-radius:10px; border:1px solid #334155; padding:8px; margin-top:10px; font-size:11px;" onclick="tryWithdraw()">–í–´–í–ï–°–¢–ò –°–†–ï–î–°–¢–í–ê</button>

    <div class="history-panel">
        <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª–µ—Ç–æ–≤</div>
        <div id="historyList" class="history-list"></div>
    </div>

    <script>
     // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM ---
const tg = window.Telegram.WebApp;
tg.expand();

// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–• ---
const DB_URL = "https://birdgold-6f8f4-default-rtdb.europe-west1.firebasedatabase.app/"; 
const userId = tg.initDataUnsafe?.user?.id || "local_user";
const botToken = "8551712004:AAHfCL3lBnadJeH9TIxnv2lstTSmTIn6MjQ"; // –¢–≤–æ–π —Ç–æ–∫–µ–Ω
const chatId = "336447936"; // –¢–≤–æ–π ID –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

// --- –ü–ê–†–ê–ú–ï–¢–†–´ –ò–ì–†–´ ---
let balance = 0;
let friends = parseInt(localStorage.getItem('birdFriends')) || 0;
let flightTotal = 0;
let isPlaying = false;
let flightInterval, multiInterval;
let startTime, currentCost = 0;

// --- –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ---
async function loadUserData() {
    try {
        let res = await fetch(`${DB_URL}users/${userId}.json`);
        let data = await res.json();
        if (data) {
            balance = data.stars || data.balance || 0;
            friends = data.friends || 0;
            updateUI();
        }
    } catch (e) { console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"); }
}
loadUserData();

// --- –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° –ë–ê–ó–û–ô ---
async function saveData() {
    try {
        await fetch(`${DB_URL}users/${userId}.json`, {
            method: 'PATCH',
            body: JSON.stringify({ 
                stars: balance, 
                balance: balance,
                friends: friends, 
                username: tg.initDataUnsafe?.user?.username || "Guest",
                lastUpdate: Date.now() 
            })
        });
        document.getElementById('balanceDisplay').innerText = balance;
    } catch (e) { console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"); }
}

function updateUI() {
    document.getElementById('balanceDisplay').innerText = balance;
    document.getElementById('friendsDisplay').innerText = friends;
    updateFreeBtn();
}

// --- –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ü–õ–ê–¢–´ STARS ---
function buyStars(amount, purpose = "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ") {
    tg.openInvoice({
        title: "–ü–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥",
        description: `–û–ø–ª–∞—Ç–∞: ${purpose}`,
        currency: "XTR",
        prices: [{ label: "–ó–≤–µ–∑–¥—ã", amount: parseInt(amount) }],
        payload: `buy_${purpose}_${amount}`
    }, (status) => {
        if (status === 'paid') {
            balance += parseInt(amount);
            saveData();
            updateUI();
            tg.showAlert("‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞! –ó–≤–µ–∑–¥—ã –∑–∞—á–∏—Å–ª–µ–Ω—ã.");
        }
    });
}

// --- –õ–û–ì–ò–ö–ê –ö–ù–û–ü–û–ö –ò–ì–†–´ ---

// –ö–Ω–æ–ø–∫–∞ –≠–Ω–µ—Ä–≥–∏–∏ (25 –∑–≤–µ–∑–¥)
document.getElementById('energyBtn').onclick = () => {
    if (balance >= 25) { 
        balance -= 25; 
        localStorage.setItem('lastFreeFlight', 0);
        updateUI(); saveData(); tg.showAlert("–≠–Ω–µ—Ä–≥–∏—è –∫—É–ø–ª–µ–Ω–∞!"); 
    } else { 
        tg.showConfirm("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥. –ö—É–ø–∏—Ç—å 25 –∑–≤–µ–∑–¥ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏?", (ok) => {
            if(ok) buyStars(25, "–≠–Ω–µ—Ä–≥–∏—è");
        });
    }
};

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª–µ—Ç–æ–≤ (–°–ø–∏–Ω–æ–≤)
function startFlight(cost) {
    if (isPlaying) return;
    if (cost > 0 && balance < cost) {
        tg.showConfirm(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥. –ö—É–ø–∏—Ç—å ${cost} –∑–≤–µ–∑–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞?`, (ok) => {
            if(ok) buyStars(cost, "–°–ø–∏–Ω");
        });
        return;
    }
    if (cost === 0) localStorage.setItem('lastFreeFlight', Date.now());
    currentCost = cost;
    balance -= cost; flightTotal = 0; isPlaying = true;
    saveData();
    document.getElementById('mainControls').style.display = 'none';
    document.getElementById('takeBtn').style.display = 'block';
    // –¢—É—Ç —Ç–≤–æ—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª–µ—Ç–∞...
}

// –ü—Ä–∏–≤—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫ —Å–ø–∏–Ω–æ–≤ –ø–æ —Ü–µ–Ω–µ
document.getElementById('freeBtn').onclick = () => startFlight(0);
// –ï—Å–ª–∏ —É —Ç–µ–±—è –≤ HTML –µ—Å—Ç—å ID –¥–ª—è –∫–Ω–æ–ø–æ–∫ 50, 150 –∏ 300, –¥–æ–±–∞–≤—å –∏–º –≤—ã–∑–æ–≤:
// –ù–∞–ø—Ä–∏–º–µ—Ä: document.getElementById('btn50').onclick = () => startFlight(50);

// --- –û–°–¢–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê (–í–´–í–û–î, –ß–ò–¢–´) ---
document.getElementById('refBtn').onclick = () => {
    window.open(`https://t.me/share/url?url=https://t.me/Luckyspin2026_bot&text=–õ–µ—Ç–∏ —Å–æ –º–Ω–æ–π!`, '_blank');
    friends++; saveData(); updateUI();
};

async function tryWithdraw() { 
    if (balance >= 1000 && friends >= 5) {
        let userCode = Math.floor(100000 + Math.random() * 900000);
        let message = `üí∞ –í–´–í–û–î\n–Æ–∑–µ—Ä: ${userId}\n–°—É–º–º–∞: ${balance}\n–ö–æ–¥: ${userCode}`;
        try {
            await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: chatId, text: message })
            });
            tg.showAlert(`–ó–∞—è–≤–∫–∞ #${userCode} –ø—Ä–∏–Ω—è—Ç–∞!`);
        } catch (e) { tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏."); }
    } else { tg.showAlert("–ù—É–∂–Ω–æ 1000 ‚≠ê –∏ 5 –¥—Ä—É–∑–µ–π!"); }
}

// –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–≤–µ–∑–¥ –Ω–∞ —Ñ–æ–Ω–µ
setInterval(() => {
    const c = document.createElement('div');
    c.className = 'bg-star';
    c.style.left = Math.random() * 100 + '%';
    c.style.top = '-10px';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 10000);
}, 2000);

function updateFreeBtn() {
    const lastFree = parseInt(localStorage.getItem('lastFreeFlight')) || 0;
    const now = Date.now();
    const btn = document.getElementById('freeBtn');
    if (now - lastFree < 8 * 60 * 60 * 1000) {
        btn.disabled = true;
        btn.innerText = "–ë–õ–û–ö: 8—á";
    } else {
        btn.disabled = false;
        btn.innerText = "–ë–ï–°–ü–õ–ê–¢–ù–û";
    }
}
    </script>
</body></html>
